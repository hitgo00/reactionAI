{"id":"cqVi","dependencies":[{"name":"/Users/hitgo/Desktop/Projects/hand-gesture/node_modules/@tensorflow/tfjs-backend-webgl/dist/reduce_gpu.js.map","includedInParent":true,"mtime":1599767831120},{"name":"/Users/hitgo/Desktop/Projects/hand-gesture/node_modules/@tensorflow/tfjs-backend-webgl/src/reduce_gpu.ts","includedInParent":true,"mtime":1599767831120},{"name":"/Users/hitgo/Desktop/Projects/hand-gesture/package.json","includedInParent":true,"mtime":1599767774914},{"name":"/Users/hitgo/Desktop/Projects/hand-gesture/.babelrc","includedInParent":true,"mtime":1599767774914},{"name":"/Users/hitgo/Desktop/Projects/hand-gesture/node_modules/@tensorflow/tfjs-backend-webgl/package.json","includedInParent":true,"mtime":1599767831120}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.ReduceProgram=void 0;class n{constructor(n,e){this.variableNames=[\"x\"];const a=n.windowSize,l=n.batchSize,t=n.inSize,i=Math.ceil(t/a);this.outputShape=[l,i];let u=\"0.0\",o=\"\";\"prod\"===e?u=\"1.0\":\"min\"===e?(u=\"1.0 / 1e-20\",o=\"min\"):\"max\"===e&&(u=\"-1.0 / 1e-20\",o=\"max\");let d=`${e}(${e}(${e}(`+\"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])\";\"sum\"===e?d=\"sumValue\":\"prod\"===e?d=\"prodValue\":\"all\"===e?d=\"allValue\":\"any\"===e&&(d=\"anyValue\");const s=4*Math.floor(a/4),c=a%4;let V=`\\n      if (${\"sum\"===e}) {\\n        sumValue += dot(values, ones);\\n      } else if (${\"prod\"===e}) {\\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\\n        prodValue *= tmp[0] * tmp[1];\\n      } else {\\n        minMaxValue = ${o}(values, minMaxValue);\\n      }\\n    `,r=\"vec4\";\"all\"===e?(u=\"1.0\",V=\"\\n        bool reducedAllValue = all(values);\\n        float floatedReducedAllValue = float(reducedAllValue);\\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\\n      \",r=\"bvec4\"):\"any\"===e&&(u=\"0.0\",V=\"\\n        bool reducedAnyValue = any(values);\\n        float floatedReducedAnyValue = float(reducedAnyValue);\\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\\n      \",r=\"bvec4\");let f=\"\";t%a>0&&(f=`\\n        if (inIdx < 0 || inIdx >= ${t}) {\\n          return initializationValue;\\n        }\\n      `),this.userCode=`\\n      const float initializationValue = ${u};\\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\\n\\n      float getValue(int batch, int inIdx) {\\n        ${f}\\n        return getX(batch, inIdx);\\n      }\\n\\n      void main() {\\n        ivec2 coords = getOutputCoords();\\n        int batch = coords[0];\\n        int outIdx = coords[1];\\n        int inOffset = outIdx * ${a};\\n\\n        vec4 minMaxValue = vec4(${u});\\n        float prodValue = 1.0;\\n        float sumValue = 0.0;\\n        float allValue = 1.0;\\n        float anyValue = 0.0;\\n\\n        for (int i = 0; i < ${s}; i += 4) {\\n          int inIdx = inOffset + i;\\n          ${r} values = ${r}(\\n            getValue(batch, inIdx),\\n            getValue(batch, inIdx + 1),\\n            getValue(batch, inIdx + 2),\\n            getValue(batch, inIdx + 3)\\n          );\\n\\n          ${V}\\n        }\\n\\n        int inIdx = inOffset + ${s};\\n        if (${1===c}) {\\n          ${r} values = ${r}(\\n            getValue(batch, inIdx),\\n            initializationValue,\\n            initializationValue,\\n            initializationValue\\n          );\\n\\n          ${V}\\n        } else if (${2===c}) {\\n          ${r} values = ${r}(\\n            getValue(batch, inIdx),\\n            getValue(batch, inIdx + 1),\\n            initializationValue,\\n            initializationValue\\n          );\\n\\n          ${V}\\n        } else if (${3===c}) {\\n          ${r} values = ${r}(\\n            getValue(batch, inIdx),\\n            getValue(batch, inIdx + 1),\\n            getValue(batch, inIdx + 2),\\n            initializationValue\\n          );\\n\\n          ${V}\\n        }\\n        setOutput(${d});\\n      }\\n    `}}exports.ReduceProgram=n;"},"sourceMaps":{"js":{"mappings":[{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":21,"column":26},"generated":{"line":1,"column":0}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":21,"column":26},"generated":{"line":1,"column":13}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":21,"column":26},"generated":{"line":1,"column":20}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":21,"column":26},"generated":{"line":1,"column":35}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":21,"column":26},"generated":{"line":1,"column":43}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":21,"column":26},"generated":{"line":1,"column":56}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":21,"column":26},"generated":{"line":1,"column":57}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":21,"column":26},"generated":{"line":1,"column":64}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":21,"column":26},"generated":{"line":1,"column":68}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":21,"column":26},"generated":{"line":1,"column":76}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":21,"column":26},"generated":{"line":1,"column":95}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":21,"column":6},"generated":{"line":1,"column":97}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":21,"column":13},"generated":{"line":1,"column":103}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":26,"column":2},"generated":{"line":1,"column":105}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":27,"column":6},"generated":{"line":1,"column":117}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":28,"column":6},"generated":{"line":1,"column":119}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":22,"column":2},"generated":{"line":1,"column":122}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":22,"column":2},"generated":{"line":1,"column":127}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":22,"column":18},"generated":{"line":1,"column":141}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":22,"column":19},"generated":{"line":1,"column":142}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":29,"column":10},"generated":{"line":1,"column":147}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":29,"column":10},"generated":{"line":1,"column":153}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":29,"column":23},"generated":{"line":1,"column":155}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":29,"column":34},"generated":{"line":1,"column":157}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":30,"column":10},"generated":{"line":1,"column":168}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":30,"column":22},"generated":{"line":1,"column":170}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":30,"column":33},"generated":{"line":1,"column":172}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":31,"column":10},"generated":{"line":1,"column":182}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":31,"column":19},"generated":{"line":1,"column":184}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":31,"column":30},"generated":{"line":1,"column":186}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":32,"column":10},"generated":{"line":1,"column":193}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":32,"column":20},"generated":{"line":1,"column":195}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":32,"column":25},"generated":{"line":1,"column":200}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":32,"column":30},"generated":{"line":1,"column":205}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":32,"column":39},"generated":{"line":1,"column":207}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":33,"column":9},"generated":{"line":1,"column":210}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":33,"column":9},"generated":{"line":1,"column":215}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":33,"column":23},"generated":{"line":1,"column":227}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":33,"column":24},"generated":{"line":1,"column":228}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":33,"column":35},"generated":{"line":1,"column":230}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":35,"column":8},"generated":{"line":1,"column":233}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":35,"column":8},"generated":{"line":1,"column":237}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":35,"column":30},"generated":{"line":1,"column":239}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":36,"column":8},"generated":{"line":1,"column":245}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":36,"column":20},"generated":{"line":1,"column":247}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":38,"column":23},"generated":{"line":1,"column":250}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":38,"column":8},"generated":{"line":1,"column":259}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":39,"column":6},"generated":{"line":1,"column":261}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":39,"column":28},"generated":{"line":1,"column":263}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":40,"column":30},"generated":{"line":1,"column":269}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":40,"column":15},"generated":{"line":1,"column":277}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":42,"column":6},"generated":{"line":1,"column":280}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":42,"column":28},"generated":{"line":1,"column":282}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":43,"column":6},"generated":{"line":1,"column":296}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":43,"column":18},"generated":{"line":1,"column":298}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":44,"column":30},"generated":{"line":1,"column":305}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":44,"column":15},"generated":{"line":1,"column":313}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":46,"column":6},"generated":{"line":1,"column":317}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":46,"column":28},"generated":{"line":1,"column":319}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":47,"column":6},"generated":{"line":1,"column":334}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":47,"column":18},"generated":{"line":1,"column":336}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":50,"column":8},"generated":{"line":1,"column":343}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":50,"column":8},"generated":{"line":1,"column":347}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":50,"column":25},"generated":{"line":1,"column":352}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":50,"column":39},"generated":{"line":1,"column":357}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":50,"column":53},"generated":{"line":1,"column":362}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":51,"column":8},"generated":{"line":1,"column":367}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":53,"column":23},"generated":{"line":1,"column":435}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":53,"column":8},"generated":{"line":1,"column":443}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":54,"column":6},"generated":{"line":1,"column":445}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":54,"column":20},"generated":{"line":1,"column":447}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":55,"column":30},"generated":{"line":1,"column":458}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":55,"column":15},"generated":{"line":1,"column":467}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":56,"column":6},"generated":{"line":1,"column":469}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":56,"column":20},"generated":{"line":1,"column":471}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":57,"column":30},"generated":{"line":1,"column":483}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":57,"column":15},"generated":{"line":1,"column":491}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":58,"column":6},"generated":{"line":1,"column":493}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":58,"column":20},"generated":{"line":1,"column":495}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":59,"column":30},"generated":{"line":1,"column":506}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":59,"column":15},"generated":{"line":1,"column":514}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":60,"column":6},"generated":{"line":1,"column":518}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":60,"column":20},"generated":{"line":1,"column":520}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":63,"column":10},"generated":{"line":1,"column":532}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":63,"column":10},"generated":{"line":1,"column":538}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":63,"column":63},"generated":{"line":1,"column":540}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":63,"column":34},"generated":{"line":1,"column":542}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":63,"column":39},"generated":{"line":1,"column":547}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":63,"column":45},"generated":{"line":1,"column":553}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":63,"column":58},"generated":{"line":1,"column":555}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":64,"column":10},"generated":{"line":1,"column":558}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":64,"column":36},"generated":{"line":1,"column":560}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":64,"column":49},"generated":{"line":1,"column":562}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":66,"column":8},"generated":{"line":1,"column":564}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":66,"column":8},"generated":{"line":1,"column":568}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":67,"column":27},"generated":{"line":1,"column":585}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":67,"column":12},"generated":{"line":1,"column":593}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":69,"column":34},"generated":{"line":1,"column":659}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":69,"column":19},"generated":{"line":1,"column":668}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":73,"column":24},"generated":{"line":1,"column":831}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":77,"column":8},"generated":{"line":1,"column":872}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":77,"column":18},"generated":{"line":1,"column":874}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":79,"column":23},"generated":{"line":1,"column":881}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":79,"column":8},"generated":{"line":1,"column":889}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":80,"column":6},"generated":{"line":1,"column":892}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":80,"column":28},"generated":{"line":1,"column":894}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":81,"column":6},"generated":{"line":1,"column":900}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":81,"column":22},"generated":{"line":1,"column":902}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":86,"column":6},"generated":{"line":1,"column":1099}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":86,"column":16},"generated":{"line":1,"column":1101}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":87,"column":30},"generated":{"line":1,"column":1110}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":87,"column":15},"generated":{"line":1,"column":1118}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":88,"column":6},"generated":{"line":1,"column":1122}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":88,"column":28},"generated":{"line":1,"column":1124}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":89,"column":6},"generated":{"line":1,"column":1130}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":89,"column":22},"generated":{"line":1,"column":1132}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":94,"column":6},"generated":{"line":1,"column":1329}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":94,"column":16},"generated":{"line":1,"column":1331}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":97,"column":8},"generated":{"line":1,"column":1340}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":97,"column":8},"generated":{"line":1,"column":1344}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":97,"column":27},"generated":{"line":1,"column":1346}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":98,"column":8},"generated":{"line":1,"column":1349}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":98,"column":17},"generated":{"line":1,"column":1351}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":98,"column":30},"generated":{"line":1,"column":1353}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":99,"column":6},"generated":{"line":1,"column":1357}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":100,"column":36},"generated":{"line":1,"column":1398}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":105,"column":9},"generated":{"line":1,"column":1464}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":105,"column":9},"generated":{"line":1,"column":1469}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":106,"column":42},"generated":{"line":1,"column":1523}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":110,"column":10},"generated":{"line":1,"column":1637}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":118,"column":34},"generated":{"line":1,"column":1851}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":120,"column":34},"generated":{"line":1,"column":1892}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":126,"column":30},"generated":{"line":1,"column":2055}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":128,"column":12},"generated":{"line":1,"column":2119}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":128,"column":32},"generated":{"line":1,"column":2133}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":135,"column":12},"generated":{"line":1,"column":2325}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":138,"column":33},"generated":{"line":1,"column":2375}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":139,"column":42},"generated":{"line":1,"column":2394}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":139,"column":14},"generated":{"line":1,"column":2398}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":140,"column":12},"generated":{"line":1,"column":2417}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":140,"column":32},"generated":{"line":1,"column":2431}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":147,"column":12},"generated":{"line":1,"column":2602}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":148,"column":49},"generated":{"line":1,"column":2627}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":148,"column":21},"generated":{"line":1,"column":2631}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":149,"column":12},"generated":{"line":1,"column":2650}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":149,"column":32},"generated":{"line":1,"column":2664}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":156,"column":12},"generated":{"line":1,"column":2842}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":157,"column":49},"generated":{"line":1,"column":2867}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":157,"column":21},"generated":{"line":1,"column":2871}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":158,"column":12},"generated":{"line":1,"column":2890}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":158,"column":32},"generated":{"line":1,"column":2904}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":165,"column":12},"generated":{"line":1,"column":3089}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":167,"column":20},"generated":{"line":1,"column":3124}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":21,"column":26},"generated":{"line":1,"column":3146}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":21,"column":26},"generated":{"line":1,"column":3154}},{"source":"../src/reduce_gpu.ts","name":null,"original":{"line":21,"column":26},"generated":{"line":1,"column":3168}}],"sources":{"../src/reduce_gpu.ts":"/**\n * @license\n * Copyright 2017 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {backend_util} from '@tensorflow/tfjs-core';\nimport {GPGPUProgram} from './gpgpu_math';\n\nexport class ReduceProgram implements GPGPUProgram {\n  variableNames = ['x'];\n  outputShape: number[];\n  userCode: string;\n\n  constructor(\n      reduceInfo: backend_util.ReduceInfo,\n      reduceType: 'all'|'any'|'max'|'min'|'sum'|'prod') {\n    const windowSize = reduceInfo.windowSize;\n    const batchSize = reduceInfo.batchSize;\n    const inSize = reduceInfo.inSize;\n    const outSize = Math.ceil(inSize / windowSize);\n    this.outputShape = [batchSize, outSize];\n\n    let initializationValue = '0.0';\n    let compareOp = ``;\n\n    if (reduceType === 'prod') {\n      initializationValue = '1.0';\n    } else if (reduceType === 'min') {\n      // WebGL on Firefox Linux can't compile 1/0 so we do 1/eps.\n      initializationValue = '1.0 / 1e-20';\n      compareOp = `min`;\n    } else if (reduceType === 'max') {\n      // WebGL on Firefox Linux can't compile 1/0 so we do 1/eps.\n      initializationValue = '-1.0 / 1e-20';\n      compareOp = `max`;\n    }\n\n    let returnValue = `${reduceType}(${reduceType}(${reduceType}(` +\n        'minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])';\n\n    if (reduceType === 'sum') {\n      returnValue = `sumValue`;\n    } else if (reduceType === 'prod') {\n      returnValue = `prodValue`;\n    } else if (reduceType === 'all') {\n      returnValue = `allValue`;\n    } else if (reduceType === 'any') {\n      returnValue = `anyValue`;\n    }\n\n    const windowSizeNearestVec4 = Math.floor(windowSize / 4) * 4;\n    const windowSizeVec4Remainder = windowSize % 4;\n\n    let updateSnippet = `\n      if (${reduceType === 'sum'}) {\n        sumValue += dot(values, ones);\n      } else if (${reduceType === 'prod'}) {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = ${compareOp}(values, minMaxValue);\n      }\n    `;\n\n    let vecType = `vec4`;\n\n    if (reduceType === 'all') {\n      initializationValue = '1.0';\n      updateSnippet = `\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      `;\n      vecType = `bvec4`;\n    } else if (reduceType === 'any') {\n      initializationValue = '0.0';\n      updateSnippet = `\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      `;\n      vecType = `bvec4`;\n    }\n\n    let checkOutOfBounds = '';\n    if (inSize % windowSize > 0) {\n      checkOutOfBounds = `\n        if (inIdx < 0 || inIdx >= ${inSize}) {\n          return initializationValue;\n        }\n      `;\n    }\n    this.userCode = `\n      const float initializationValue = ${initializationValue};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ${checkOutOfBounds}\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${windowSize};\n\n        vec4 minMaxValue = vec4(${initializationValue});\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < ${windowSizeNearestVec4}; i += 4) {\n          int inIdx = inOffset + i;\n          ${vecType} values = ${vecType}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ${updateSnippet}\n        }\n\n        int inIdx = inOffset + ${windowSizeNearestVec4};\n        if (${windowSizeVec4Remainder === 1}) {\n          ${vecType} values = ${vecType}(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          ${updateSnippet}\n        } else if (${windowSizeVec4Remainder === 2}) {\n          ${vecType} values = ${vecType}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          ${updateSnippet}\n        } else if (${windowSizeVec4Remainder === 3}) {\n          ${vecType} values = ${vecType}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          ${updateSnippet}\n        }\n        setOutput(${returnValue});\n      }\n    `;\n  }\n}\n"},"lineCount":null}},"error":null,"hash":"9d3435c1f0fe4d18c078a5af3d1b7a3f","cacheData":{"env":{}}}